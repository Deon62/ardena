<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Reset your ardena account password.">
    <meta name="robots" content="noindex, nofollow">
    <title>Reset password - ardena</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="canonical" href="https://ardena.xyz/reset-password.html">
</head>
<body>
    <main class="reset-password-page">
        <section class="reset-password-section">
            <div class="reset-password-container">
                <div class="reset-password-card">
                    <h1 class="reset-password-title">Reset password</h1>
                    <p class="reset-password-subtitle">Enter your new password below. Use at least 8 characters.</p>
                    <form class="reset-password-form" id="resetPasswordForm" action="#" method="post" novalidate>
                        <div class="form-group">
                            <label for="reset-new-password">New password</label>
                            <input type="password" id="reset-new-password" name="new_password" required minlength="8" placeholder="Enter new password" autocomplete="new-password">
                        </div>
                        <div class="form-group">
                            <label for="reset-confirm-password">Confirm password</label>
                            <input type="password" id="reset-confirm-password" name="confirm_password" required minlength="8" placeholder="Confirm new password" autocomplete="new-password">
                        </div>
                        <div id="reset-form-message" class="reset-form-message" role="alert" aria-live="polite" hidden></div>
                        <button type="submit" class="btn btn-primary reset-password-btn">Set new password</button>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <script>
        (function() {
            var API_URL = 'https://api.ardena.xyz/api/v1/host/auth/reset-password';
            var SUCCESS_REDIRECT = 'ardenahost://';

            var form = document.getElementById('resetPasswordForm');
            var newP = document.getElementById('reset-new-password');
            var confirmP = document.getElementById('reset-confirm-password');
            var msgEl = document.getElementById('reset-form-message');
            var submitBtn = form ? form.querySelector('.reset-password-btn') : null;

            function getTokenFromUrl() {
                var params = new URLSearchParams(window.location.search);
                return params.get('token') || '';
            }

            function showMessage(text, isError) {
                if (!msgEl) return;
                msgEl.textContent = text;
                msgEl.hidden = false;
                msgEl.className = 'reset-form-message ' + (isError ? 'reset-form-message--error' : 'reset-form-message--success');
            }

            function setLoading(loading) {
                if (submitBtn) {
                    submitBtn.disabled = loading;
                    submitBtn.textContent = loading ? 'Resettingâ€¦' : 'Set new password';
                }
            }

            if (form) {
                var token = getTokenFromUrl();
                if (!token) {
                    showMessage('Invalid or missing reset link. Please use the link from your email.', true);
                }

                form.addEventListener('submit', function(e) {
                    e.preventDefault();

                    if (!token) {
                        showMessage('Invalid or missing reset link. Please use the link from your email.', true);
                        return;
                    }
                    if (newP.value.length < 8) {
                        showMessage('Password must be at least 8 characters.', true);
                        return;
                    }
                    if (newP.value !== confirmP.value) {
                        showMessage('Passwords do not match.', true);
                        return;
                    }

                    msgEl.hidden = true;
                    msgEl.textContent = '';
                    setLoading(true);

                    fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            token: token,
                            new_password: newP.value,
                            new_password_confirmation: confirmP.value
                        })
                    })
                    .then(function(res) {
                        return res.json().then(function(data) {
                            return { ok: res.ok, status: res.status, data: data };
                        }).catch(function() {
                            return { ok: res.ok, status: res.status, data: {} };
                        });
                    })
                    .then(function(result) {
                        setLoading(false);
                        if (result.ok && result.data.message) {
                            showMessage(result.data.message, false);
                            window.location.href = SUCCESS_REDIRECT;
                        } else if (result.ok) {
                            window.location.href = SUCCESS_REDIRECT;
                        } else {
                            var errMsg = (result.data && result.data.message) || (result.data && result.data.errors && JSON.stringify(result.data.errors)) || 'Something went wrong. Please try again.';
                            showMessage(errMsg, true);
                        }
                    })
                    .catch(function() {
                        setLoading(false);
                        showMessage('Network error. Please check your connection and try again.', true);
                    });
                });
            }
        })();
    </script>
</body>
</html>
